# 项目文件说明

此文档列出仓库中主要文件及其作用，便于快速理解代码结构与职责分工。

## 根目录文件

- `pom.xml`：Maven 项目描述文件，定义依赖、插件、构建和打包配置。
- `README.md`：项目说明文档（已有），包含项目简介与快速启动指引。
- `sql/table.sql`：数据库表和初始化 SQL，包含项目所需的表结构与示例数据导入语句。

## 配置文件（src/main/resources）

- `application.yml`：主配置文件，包含通用配置项（数据库、缓存、日志等）。
- `application-dev.yml`：开发环境覆盖配置，通常用于本地调试时替换或补充 `application.yml`。
- `application-prod.yml`：生产环境覆盖配置，包含生产级别的连接、凭证与调优参数。

## 启动类

- `src/main/java/com/sipc/hospitalalarmsystem/HospitalAlarmSystemApplication.java`：Spring Boot 启动类，项目入口，负责启动 Spring 容器与自动配置。

## 控制器（`controller`）

- `UserController.java`：用户相关接口（登录、注册、修改密码、获取用户信息等）的 HTTP 请求入口层，负责参数校验与权限注解。
- `MonitorController.java`：监控点（摄像头/监测位）管理相关接口（增删改查、位置更新、列表查询等）。
- `AlarmController.java`：告警相关接口（实时告警推送、历史告警查询、告警详情、状态修改等）。
- `GptController.java`：与 GPT/大模型交互的接口（对话、问答或模型转发请求）。
- `CbsController.java`：与 CBS（第三方/平台服务）交互的接口，负责接收或转发 CBS 消息与回调。

说明：控制器层负责接收 HTTP 请求、调用服务层并返回统一的 DTO/Result 格式。

## 服务层（`service`、`service.impl`）

- `UserService.java` / `UserServiceImpl.java`：封装用户业务逻辑（权限校验、密码加密、用户信息维护、token 处理等）。
- `MonitorService.java` / `MonitorServiceImpl.java`：处理监控点业务（创建、更新、坐标映射、状态同步等）。
- `AlarmService.java` / `AlarmServiceImpl.java`：告警业务逻辑（入库、去重、实时推送、统计与聚合）。
- `GptService.java` / `GptServiceImpl.java`：封装与大模型（GPT）交互的逻辑（请求构造、流式响应监听、事件源处理）。
- `CbsService.java` / `CbsServiceImpl.java`：实现与 CBS 的具体交互（客户端封装、异步回调处理）。
- `RecordService.java` / `RecordServiceImpl.java`：录像/事件记录相关逻辑的实现。
- `RequestFlaskService.java` / `RequestFlaskServiceImpl.java`：用于向外部 Flask 服务（例如模型推理服务）发送请求并处理响应。

说明：服务层实现业务规则、事务控制，并调用 DAO 层进行持久化操作。

## 数据访问层（`dao`）

- `UserDao.java`：用户表的数据库访问接口（MyBatis/Mapper），定义 CRUD 和自定义查询。
- `MonitorDao.java`：监控点相关的数据库访问接口。
- `AlarmDao.java`：告警相关的数据库访问接口。

说明：DAO 层直接与数据库交互，通常对应实体（PO）与表结构。

## 模型层（`model`）

- `model/po`：持久化对象（PO）包，包含与数据库表直接映射的实体类，例如：
  - `model/po/User/User.java`：用户实体，包含字段映射如 id、用户名、密码哈希、角色等。
  - `model/po/Monitor/Monitor.java`：监控点实体，包含坐标、设备 id、所属区域等信息。
  - `model/po/Alarm/*`：告警相关实体（`Alarm.java`、`TimePeriod.java`、`AlarmTotal.java` 等），用于存储告警数据与统计信息。

- `model/dto`：数据传输对象（DTO），用于控制器层与客户端交换数据：
  - `param`：请求参数对象（如 `LoginParam.java`、`CreateMonitorParam.java`、`UpdateAlarmParam.java`）。
  - `res`：响应对象（如 `LoginRes.java`、`GetMonitorListRes.java`、`RealTimeAlarmRes.java`）。
  - `enumeration/ResultEnum.java`：统一的结果码枚举定义。

说明：PO 与 DTO 分离有助于解耦持久层结构与对外 API。

## 配置类（`config`）

- `WebSocketConfig.java`：WebSocket 相关的 Spring 配置（端点、拦截器、消息处理器等）。
- `WebMvcConfig.java`：MVC 配置（跨域、静态资源、拦截器配置等）。
- `RedisCacheManagerConfig.java`：Redis 缓存管理与序列化相关配置。
- `OssConfig.java`：对象存储（OSS）客户端配置（如阿里 OSS、MinIO 等的 endpoint、凭证配置）。
- `config/mybatisPlus/MpConfig.java` 和 `TimeMetaObjectHandler.java`：MyBatis-Plus 的配置与自动填充（如创建/更新时间自动写入）。

## 辅助工具类（`util`、`video`、`sparkdesk` 等）

- `JwtUtils.java`：JWT 生成与解析、过期校验方法。
- `MD5Util.java`：MD5 加密工具（通常用于密码哈希或签名计算）。
- `JacksonUtils.java`：封装 Jackson 的 JSON 序列化/反序列化快捷方法。
- `RedisUtil.java`：Redis 操作封装（常见的 get/set、发布订阅或分布式锁简化）。
- `OssUtil.java`：对象存储操作工具（上传、下载、删除文件的封装）。
- `WebsocketUtil.java` / `SseHelper.java`：WebSocket / Server-Sent Events 的工具方法，用于向前端推送实时消息。
- `HttpUtils.java`：HTTP 请求封装（用于调用外部服务，如 Flask、CBS、第三方 API）。
- `RecordUtil.java`：录像/记录文件相关操作的通用方法。
- `Base64Util.java`、`KeyUtils/*`：编码与密钥管理相关的工具类，`KeyManager` 等用于密钥轮换或存储。
- `MonitorCommon.java`（video 包）：视频流或监控点通用方法，可能包含解析流地址、拼接 RTSP/HTTP 播放地址等逻辑。
- `sparkdesk` 包（如 `WebSocketClient.java`、`SparkBigModel.java`、`BigModelNew.java`）：与大模型服务/外部推理服务的客户端实现、长连接或推理请求封装。

## AOP（切面）

- `aop/JwtInterceptor.java`：用于拦截请求并校验 JWT 的拦截器或注解处理逻辑。
- `aop/ClearRedis.java`、`ClearRedisImpl.java`：用于在特定操作后清理 Redis 缓存的切面逻辑（缓存一致性处理）。
- `aop/Pass.java`：用作方法标记（跳过拦截或特殊处理）的注解定义。

## 异常与统一响应处理

- `exception/ExceptionHandle.java`：全局异常处理（ControllerAdvice），将异常转换为统一的 `CommonResult`/错误码结构返回给客户端。
- `model/dto/CommonResult.java`：统一封装 API 返回格式，包含状态码、消息与数据字段。

## 其他说明

- `target/`：Maven 构建输出目录，包含编译后的类、生成的 JAR（不需纳入源码说明，构建产物）。
- `generated-sources/` 与 `generated-test-sources/`：maven 或插件生成的源码目录，通常为构建或注解处理器产物。

---

如果你希望我对每个 Java 文件写更细粒度（例如每个类的关键方法说明、重要字段含义或示例调用流程），我可以基于源码逐文件读取并补充更详细的条目；现在我已将总体职责和每个文件/包的用途整理完毕。
